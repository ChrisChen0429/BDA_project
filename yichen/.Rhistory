Mi = rep(8,N) # number of item in ith cluster and same as m in one stage cluster
M0 = sum(Mi)
yi_bar = rep(c(3,2,0),c(2,1,1)) / Mi[1]
yi_bar
N = 100 # number of clusters
n = 5 # number of cluster to sample
Mi = rep(8,N) # number of item in ith cluster and same as m in one stage cluster
M0 = sum(Mi)
yi_bar = rep(c(3,2,0),c(2,1,2)) / Mi[1]
M0 = sum(Mi)
yi_bar
N = 100 # number of clusters
n = 5 # number of cluster to sample
Mi = rep(8,N) # number of item in ith cluster and same as m in one stage cluster
M0 = sum(Mi)
yi_bar = rep(c(3,2,0),c(2,1,2)) / Mi[1]
ti_hat =
ti_hat = Mi[0] * yi_bar
ti_hat
yi_bar
ti_hat = Mi[1] * yi_bar
ti_hat
N = 100 # number of clusters
n = 5 # number of cluster to sample
M = 8 # number of item in ith cluster and same as m in one stage cluster
M0 = sum(rep(M,N))
yi_bar = rep(c(3,2,0),c(2,1,2)) / M
ti_hat = M * yi_bar
tunb_hat = (N/n) * sum(ti_hat)
tunb_hat
N = 100 # number of clusters
n = 5 # number of cluster to sample
M = 8 # number of item in ith cluster and same as m in one stage cluster
M0 = sum(rep(M,N))
yi_bar = rep(c(3,2,0),c(2,1,2)) / M
ti_hat = M * yi_bar
tunb_hat = (N/n) * sum(ti_hat)
s_t_2 = (1/(n-1)) * sum((ti_hat - tunb_hat/N) ^ 2)
N = 100 # number of clusters
n = 5 # number of cluster to sample
M = 8 # number of item in ith cluster and same as m in one stage cluster
M0 = sum(rep(M,N))
yi_bar = rep(c(3,2,0),c(2,1,2)) / M
ti_hat = M * yi_bar
tunb_hat = (N/n) * sum(ti_hat)
s_t_2 = (1/(n-1)) * sum((ti_hat - tunb_hat/N) ^ 2)
tunb_hat ; s_t_2
y = rep(c(1,0),c(8,n-8))
y = rep(c(1,0),c(8,n-8))
N = 800
n = 40
y = rep(c(1,0),c(8,n-8))
y
ys_bar =  sum(y) / n
ys_bar
ss_2 = (1/n) * sum((y - ys_bar)^2)
ss_2
N = 100 # number of clusters
n = 5 # number of cluster to sample
M = 8 # number of item in ith cluster and same as m in one stage cluster
M0 = sum(rep(M,N))
yi_bar = rep(c(3,2,0),c(2,1,2)) / M
ti_hat = M * yi_bar
tunb_hat = (N/n) * sum(ti_hat)
s_t = sqrt((1/(n-1)) * sum((ti_hat - tunb_hat/N) ^ 2))
tunb_hat ; s_t
N = 800
n = 40
y = rep(c(1,0),c(8,n-8))
ys_bar =  sum(y) / n
t_hat = N * ys_bar
ss_2 = (1/n) * sum((y - ys_bar)^2)
se_t = sqrt(N^2 *(ss_2/n) * (1-n/N))
t_hat; se_t
ss_2
ti_hat = Mi * yi_hat
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_hat = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_hat
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_hat = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_hat
tunb_hat = (N/n) * sum(ti_hat)
tunb_hat
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_hat = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_hat
tunb_hat = (N/n) * sum(ti_hat)
yunb_hat = tunb_hat / M0
yunb_hat
se_tunb_hat = sqrt(N^2 * (st_2 /n) * (1-n/N) + sum( ( (si_2*Mi^2)/mi) * (1 - mi/Mi) ))
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_hat = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_hat
tunb_hat = (N/n) * sum(ti_hat)
yunb_hat = tunb_hat / M0
st_2 = (1/(n-1)) * sum((ti_hat - tunb_hat/N)^2)
se_tunb_hat = sqrt(N^2 * (st_2 /n) * (1-n/N) + sum( ( (si_2*Mi^2)/mi) * (1 - mi/Mi) ))
se_yunb_hat = se_tunb_hat / M0
yunb_hat
se_yunb_hat
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
yr_bar_hat
sum(Mi*yi_bar) / sum(Mi)
sum(Mi*yi_bar) / sum(Mi)
sum(Mi*yi_bar)
Mi*yi_bar
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
yr_bar_hat
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
sr_2
se_yr_bar_hat = sqrt((sr_2/(n * mean(Mi)^2)) * (1 - n/N) + (1/(n*N*mean(Mi)^2)) * sum(si_2*(Mi^2/mi) *(1-mi/Mi)))
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
se_yr_bar_hat = sqrt((sr_2/(n * mean(Mi)^2)) * (1 - n/N) + (1/(n*N*mean(Mi)^2)) * sum(si_2*(Mi^2/mi) *(1-mi/Mi)))
yr_bar_hat;se_yr_bar_hat
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
se_yr_bar_hat = sqrt((sr_2/(n * mean(Mi)^2)) * (1 - n/N) + (1/(n*N*mean(Mi)^2)) * sum(si_2*(Mi^2/mi) *(1-mi/Mi)))
yr_bar_hat;se_yr_bar_hat
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_hat = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_hat
tunb_hat = (N/n) * sum(ti_hat)
yunb_hat = tunb_hat / M0
st_2 = (1/(n-1)) * sum((ti_hat - tunb_hat/N)^2)
se_tunb_hat = sqrt(N^2*(st_2/n)*(1-n/N)+sum(((si_2*Mi^2)/mi)*(1 - mi/Mi)))
se_yunb_hat = se_tunb_hat / M0
yunb_hat;se_yunb_hat
Mi^2 * (yi_bar - yr_bar_hat)^2
Mi^2
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_bar = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_bar
ti_hat
N = 20 # number of cluseter
n = 4  # number of cluseter be sampled
M0 = 940 # total population size
Mi = c(17,56,23,64) # cluster size
mi = c(10,25,12,30) # sample size in step two
yi_bar = c(32.7,36.1,30.3,33.4)  # cluster sample mean
si_2 = c(26.3,21.4,23.6,29.1)    # cluster sample variance
ti_hat = Mi * yi_bar
tunb_hat = (N/n) * sum(ti_hat)
yunb_hat = tunb_hat / M0
st_2 = (1/(n-1)) * sum((ti_hat - tunb_hat/N)^2)
se_tunb_hat = sqrt(N^2*(st_2/n)*(1-n/N)+sum(((si_2*Mi^2)/mi)*(1 - mi/Mi)))
se_yunb_hat = se_tunb_hat / M0
yunb_hat;se_yunb_hat
yi_bar
yr_bar_hat
yr_bar_hat
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
yr_bar_hat = ((N/n) * sum(ti_hat))/((N/n) * sum(Mi))
sr_2 = (1/(n-1)) * sum(Mi^2 * (yi_bar - yr_bar_hat)^2)
se_yr_bar_hat = sqrt((sr_2/(n * mean(Mi)^2)) * (1 - n/N) + (1/(n*N*mean(Mi)^2)) * sum(si_2*(Mi^2/mi) *(1-mi/Mi)))
yr_bar_hat;se_yr_bar_hat
phi = Mi /Mo
Mi = c(110,265,360,1265)
M0 = sum(Mi)
phi = Mi /Mo
phi = Mi / M0
phi
# every draw is independent
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
Mi = c(110,265,360,1265)
Sales = c(44,82,112,362)
M0 = sum(Mi)
phi = Mi / M0
N = 4
n = 2
# every draw is independent
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
E_tphi_hat
Mi = c(110,265,360,1265)
Sales = c(44,82,112,362)
M0 = sum(Mi)
phi = Mi / M0
N = 4
n = 2
# every draw is independent
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
E_tphi2_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi2_hat = E_tphi2_hat + phi[i] * phi[j] * tphi_hat
}
}
v_tphi_hat = E_tphi2_hat - E_tphi_hat^2
v_tphi_hat
Mi = c(110,265,360,1265)
Sales = c(44,82,112,362)
M0 = sum(Mi)
phi = Mi / M0
N = 4
n = 2
# every draw is independent
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
E_tphi2_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi2_hat = ((1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j])))^2
E_tphi2_hat = E_tphi2_hat + phi[i] * phi[j] * tphi2_hat
}
}
v_tphi_hat = E_tphi2_hat - E_tphi_hat^2
v_tphi_hat
Mi = c(110,265,360,1265)
Sales = c(44,82,112,362)
M0 = sum(Mi)
phi = Mi / M0
N = 4
n = 2
# every draw is independent
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
E_tphi2_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi2_hat = ((1/n) * sum((Sales[i]/phi[i]),(Sales[j]/phi[j])))^2
E_tphi2_hat = E_tphi2_hat + phi[i] * phi[j] * tphi2_hat
}
}
v_tphi_hat = E_tphi2_hat - E_tphi_hat^2
E_tphi_hat;v_tphi_hat
phi = c(1,1,1,1) /4
phi
phi = c(1,1,1,1) /4
E_tphi_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi_hat = (N * mean(Sales[i],Sales[j]))
E_tphi_hat = E_tphi_hat + phi[i] * phi[j] * tphi_hat
}
}
E_tphi2_hat = 0
for ( i in 1:N){
for ( j in 1:N){
tphi2_hat = (N * mean(Sales[i],Sales[j]))^2
E_tphi2_hat = E_tphi2_hat + phi[i] * phi[j] * tphi2_hat
}
}
v_tphi_hat = E_tphi2_hat - E_tphi_hat^2
E_tphi_hat;v_tphi_hat
setwd("~/BDA_project/yichen")
knitr::opts_chunk$set(echo = TRUE)
data <- read.delim2('core.txt', header = TRUE,sep = '|',quote = "\n")
data <- data[5:nrow(data),]
## the first 4 lines seems to be wrong, delete it
#rand_y <- sample(c(0,1,2),size = length(data$y),prob = c(0.7,0.2,0.1),replace = T)
#data$y <- rand_y
N = length(unique(data$state))
A <- matrix(0,ncol = N,nrow = N)
colnames(A) = unique(data$state)
rownames(A) = unique(data$state)
A['NUEVO LEON',c('ZACATECAS','SAN LUIS POTOSI','TAMAULIPAS','COAHUILA DE ZARAGOZA')] = 1
A[c('ZACATECAS','SAN LUIS POTOSI','TAMAULIPAS','COAHUILA DE ZARAGOZA'),'NUEVO LEON'] = 1
A['VERACRUZ LLAVE',c('TAMAULIPAS','SAN LUIS POTOSI','HIDALGO','PUEBLA','OAXACA','CHIAPAS','TABASCO')] = 1
A[c('TAMAULIPAS','SAN LUIS POTOSI','HIDALGO','PUEBLA','OAXACA','CHIAPAS','TABASCO'),'VERACRUZ LLAVE'] = 1
A['GUANAJUATO',c('MICHOACAN DE OCAMPO','JALISCO','SAN LUIS POTOSI','ZACATECAS','QUERETARO DE ARTEAGA')] = 1
A[c('MICHOACAN DE OCAMPO','JALISCO','SAN LUIS POTOSI','ZACATECAS','QUERETARO DE ARTEAGA'),'GUANAJUATO'] = 1
A['NAYARIT',c('SINALOA','DURANGO','ZACATECAS','JALISCO')] = 1
A[c('SINALOA','DURANGO','ZACATECAS','JALISCO'),'NAYARIT'] = 1
A['JALISCO',c('NAYARIT','ZACATECAS','COLIMA','MICHOACAN DE OCAMPO','GUANAJUATO','AGUASCALIENTES')] = 1
A[c('NAYARIT','ZACATECAS','COLIMA','MICHOACAN DE OCAMPO','GUANAJUATO','AGUASCALIENTES'),'JALISCO'] = 1
######
A['MORELOS',c('GUERRERO','PUEBLA','ESTADO DE MEXICO')] = 1
A[c('GUERRERO','PUEBLA','ESTADO DE MEXICO'),'MORELOS'] = 1
A['MICHOACAN DE OCAMPO',c('COAHUILA DE ZARAGOZA','ESTADO DE MEXICO','JALISCO','GUANAJUATO','GUERRERO','QUERETARO DE ARTEAGA')] = 1
A[c('COAHUILA DE ZARAGOZA','JALISCO','ESTADO DE MEXICO','GUANAJUATO','GUERRERO','QUERETARO DE ARTEAGA'),'MICHOACAN DE OCAMPO'] = 1
A['ESTADO DE MEXICO',c('HIDALGO','QUERETARO DE ARTEAGA','MICHOACAN DE OCAMPO','GUERRERO','PUEBLA','TLAXCALA','MORELOS')] = 1
A[c('HIDALGO','QUERETARO DE ARTEAGA','MICHOACAN DE OCAMPO','GUERRERO','PUEBLA','TLAXCALA','MORELOS'), 'ESTADO DE MEXICO'] = 1
A['HIDALGO',c('ESTADO DE MEXICO','QUERETARO DE ARTEAGA','SAN LUIS POTOSI','VERACRUZ LLAVE','PUEBLA','TLAXCALA')] = 1
A[c('ESTADO DE MEXICO','QUERETARO DE ARTEAGA','SAN LUIS POTOSI','VERACRUZ LLAVE','PUEBLA','TLAXCALA'),'HIDALGO'] = 1
A['ZACATECAS',c('JALISCO','NAYARIT','DURANGO','COAHUILA DE ZARAGOZA','NUEVO LEON','TAMAULIPAS','SAN LUIS POTOSI','AGUASCALIENTES')] = 1
A[c('JALISCO','NAYARIT','DURANGO','COAHUILA DE ZARAGOZA','NUEVO LEON','TAMAULIPAS','SAN LUIS POTOSI','AGUASCALIENTES'),'ZACATECAS'] = 1
A['GUERRERO',c('MICHOACAN DE OCAMPO','PUEBLA','ESTADO DE MEXICO','MORELOS')] = 1
A[c('MICHOACAN DE OCAMPO','PUEBLA','ESTADO DE MEXICO','MORELOS'),'GUERRERO'] = 1
A['DURANGO',c('CHIHUAHUA','COAHUILA DE ZARAGOZA','ZACATECAS','NAYARIT','SINALOA')] = 1
A[c('CHIHUAHUA','COAHUILA DE ZARAGOZA','ZACATECAS','NAYARIT','SINALOA'),'DURANGO'] = 1
A['CHIHUAHUA',c('DURANGO','SINALOA','COAHUILA DE ZARAGOZA','SONORA')] = 1
A[c('DURANGO','SINALOA','COAHUILA DE ZARAGOZA','SONORA'),'CHIHUAHUA'] = 1
A['CHIAPAS',c('OAXACA','VERACRUZ LLAVE','TABASCO','CAMPECHE')] = 1
A[c('OAXACA','VERACRUZ LLAVE','TABASCO','CAMPECHE'),'CHIAPAS'] = 1
A['COLIMA',c('JALISCO','MICHOACAN DE OCAMPO')] = 1
A[c('JALISCO','MICHOACAN DE OCAMPO'),'COLIMA'] = 1　
A['COAHUILA DE ZARAGOZA',c('NUEVO LEON','ZACATECAS','DURANGO','CHIHUAHUA','SAN LUIS POTOSI')] = 1
A[c('NUEVO LEON','ZACATECAS','DURANGO','CHIHUAHUA','SAN LUIS POTOSI'),'COAHUILA DE ZARAGOZA'] = 1
A['SAN LUIS POTOSI',c('TABASCO','NUEVO LEON','COAHUILA DE ZARAGOZA','ZACATECAS','JALISCO','GUANAJUATO','QUERETARO DE ARTEAGA','HIDALGO','VERACRUZ LLAVE')] = 1
A[c('TABASCO','NUEVO LEON','COAHUILA DE ZARAGOZA','ZACATECAS','JALISCO','GUANAJUATO','QUERETARO DE ARTEAGA','HIDALGO','VERACRUZ LLAVE'),'SAN LUIS POTOSI'] = 1
A['CAMPECHE',c('TABASCO','QUINTANA ROO','YUCATAN')] = 1
A[c('TABASCO','QUINTANA ROO','YUCATAN'),'CAMPECHE'] = 1
A['BAJA CALIFORNIA SUR',c('BAJA CALIFORNIA','SONORA','SINALOA')] = 1
A[c('BAJA CALIFORNIA','SONORA','SINALOA'),'BAJA CALIFORNIA SUR'] = 1
A['BAJA CALIFORNIA',c('BAJA CALIFORNIA SUR','SONORA')] = 1
A[c('BAJA CALIFORNIA SUR','SONORA'),'BAJA CALIFORNIA'] = 1
A['AGUASCALIENTES',c('ZACATECAS','JALISCO')] = 1
A[c('ZACATECAS','JALISCO'),'AGUASCALIENTES'] = 1
A['YUCATAN',c('CAMPECHE','QUINTANA ROO')] = 1
A[c('CAMPECHE','QUINTANA ROO'),'YUCATAN'] = 1
A['TAMAULIPAS',c('NUEVO LEON','SAN LUIS POTOSI','VERACRUZ LLAVE')] = 1
A[c('NUEVO LEON','SAN LUIS POTOSI','VERACRUZ LLAVE'),'TAMAULIPAS'] = 1
A['TABASCO',c('CAMPECHE','CHIAPAS','VERACRUZ LLAVE')] = 1
A[c('CAMPECHE','CHIAPAS','VERACRUZ LLAVE'),'TABASCO'] = 1
A['SONORA',c('BAJA CALIFORNIA','BAJA CALIFORNIA SUR','SINALOA','CHIHUAHUA')] = 1
A[c('BAJA CALIFORNIA','BAJA CALIFORNIA SUR','SINALOA','CHIHUAHUA'),'SONORA'] = 1
A['SINALOA',c('SONORA','CHIHUAHUA','DURANGO','NAYARIT')] = 1
A[c('SONORA','CHIHUAHUA','DURANGO','NAYARIT'),'SINALOA'] = 1
A['QUINTANA ROO',c('YUCATAN','CAMPECHE')] = 1
A[c('YUCATAN','CAMPECHE'),'QUINTANA ROO'] =1
A['QUERETARO DE ARTEAGA',c('SAN LUIS POTOSI','HIDALGO','ESTADO DE MEXICO','GUANAJUATO','MICHOACAN DE OCAMPO')] = 1
A[c('SAN LUIS POTOSI','HIDALGO','ESTADO DE MEXICO','GUANAJUATO','MICHOACAN DE OCAMPO'),'QUERETARO DE ARTEAGA'] = 1
A['PUEBLA',c('ESTADO DE MEXICO','MORELOS','TLAXCALA','GUERRERO','OAXACA','VERACRUZ LLAVE','HIDALGO')] = 1
A[c('ESTADO DE MEXICO','MORELOS','TLAXCALA','GUERRERO','OAXACA','VERACRUZ LLAVE','HIDALGO'),'PUEBLA'] = 1
A['TLAXCALA',c('ESTADO DE MEXICO','HIDALGO','PUEBLA')] = 1
A[c('ESTADO DE MEXICO','HIDALGO','PUEBLA'),'TLAXCALA'] = 1
A['OAXACA',c('GUERRERO','PUEBLA','VERACRUZ LLAVE','CHIAPAS')] = 1
A[c('GUERRERO','PUEBLA','VERACRUZ LLAVE','CHIAPAS'),'OAXACA'] =1
library(rstan)
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
model <- stan_model('yi.stan')
X <- cbind(data$sex,data$age,data$asset_market_value,data$months_employed,data$ratio)
colnames(X) <- c('sex', 'age','asset market value','month employed','ratio')
scaled_x <- scale(X)
y = as.numeric(data$y)
y[y==1] = 0
y[y==2] = 1
state = as.vector(data$state)
unique_s = unique(state)
for (i in 1:32){
s = as.character(unique_s[i])
state[state==s] = as.numeric(i)
}
state = as.numeric(state)
X <- model.matrix(~scaled_x)
data_list <- list(k = nrow(X),         # number of observations
n = nrow(A),
p = ncol(X),         # number of coefficients
X = X,               # design matrix
y = y,               # observed number of cases
W = A,
k = 32,
W_n = sum(A) / 2,    # number of neighbor pairs
state = state)               # adjacency matrix
fit <- sampling(model, data = data_list)
nrow(A)
isSymmetric.matrix(A)
colSums(A)
A['DISTRITO FEDERAL',c('ESTADO DE MEXICO','MORELOS')] = 1
A[c('ESTADO DE MEXICO','MORELOS'),'DISTRITO FEDERAL'] = 1
N = length(unique(data$state))
A <- matrix(0,ncol = N,nrow = N)
colnames(A) = unique(data$state)
rownames(A) = unique(data$state)
A['NUEVO LEON',c('ZACATECAS','SAN LUIS POTOSI','TAMAULIPAS','COAHUILA DE ZARAGOZA')] = 1
A[c('ZACATECAS','SAN LUIS POTOSI','TAMAULIPAS','COAHUILA DE ZARAGOZA'),'NUEVO LEON'] = 1
A['VERACRUZ LLAVE',c('TAMAULIPAS','SAN LUIS POTOSI','HIDALGO','PUEBLA','OAXACA','CHIAPAS','TABASCO')] = 1
A[c('TAMAULIPAS','SAN LUIS POTOSI','HIDALGO','PUEBLA','OAXACA','CHIAPAS','TABASCO'),'VERACRUZ LLAVE'] = 1
A['GUANAJUATO',c('MICHOACAN DE OCAMPO','JALISCO','SAN LUIS POTOSI','ZACATECAS','QUERETARO DE ARTEAGA')] = 1
A[c('MICHOACAN DE OCAMPO','JALISCO','SAN LUIS POTOSI','ZACATECAS','QUERETARO DE ARTEAGA'),'GUANAJUATO'] = 1
A['NAYARIT',c('SINALOA','DURANGO','ZACATECAS','JALISCO')] = 1
A[c('SINALOA','DURANGO','ZACATECAS','JALISCO'),'NAYARIT'] = 1
A['JALISCO',c('NAYARIT','ZACATECAS','COLIMA','MICHOACAN DE OCAMPO','GUANAJUATO','AGUASCALIENTES')] = 1
A[c('NAYARIT','ZACATECAS','COLIMA','MICHOACAN DE OCAMPO','GUANAJUATO','AGUASCALIENTES'),'JALISCO'] = 1
A['DISTRITO FEDERAL',c('ESTADO DE MEXICO','MORELOS')] = 1
A[c('ESTADO DE MEXICO','MORELOS'),'DISTRITO FEDERAL'] = 1
A['MORELOS',c('GUERRERO','PUEBLA','ESTADO DE MEXICO')] = 1
A[c('GUERRERO','PUEBLA','ESTADO DE MEXICO'),'MORELOS'] = 1
A['MICHOACAN DE OCAMPO',c('COAHUILA DE ZARAGOZA','ESTADO DE MEXICO','JALISCO','GUANAJUATO','GUERRERO','QUERETARO DE ARTEAGA')] = 1
A[c('COAHUILA DE ZARAGOZA','JALISCO','ESTADO DE MEXICO','GUANAJUATO','GUERRERO','QUERETARO DE ARTEAGA'),'MICHOACAN DE OCAMPO'] = 1
A['ESTADO DE MEXICO',c('HIDALGO','QUERETARO DE ARTEAGA','MICHOACAN DE OCAMPO','GUERRERO','PUEBLA','TLAXCALA','MORELOS')] = 1
A[c('HIDALGO','QUERETARO DE ARTEAGA','MICHOACAN DE OCAMPO','GUERRERO','PUEBLA','TLAXCALA','MORELOS'), 'ESTADO DE MEXICO'] = 1
A['HIDALGO',c('ESTADO DE MEXICO','QUERETARO DE ARTEAGA','SAN LUIS POTOSI','VERACRUZ LLAVE','PUEBLA','TLAXCALA')] = 1
A[c('ESTADO DE MEXICO','QUERETARO DE ARTEAGA','SAN LUIS POTOSI','VERACRUZ LLAVE','PUEBLA','TLAXCALA'),'HIDALGO'] = 1
A['ZACATECAS',c('JALISCO','NAYARIT','DURANGO','COAHUILA DE ZARAGOZA','NUEVO LEON','TAMAULIPAS','SAN LUIS POTOSI','AGUASCALIENTES')] = 1
A[c('JALISCO','NAYARIT','DURANGO','COAHUILA DE ZARAGOZA','NUEVO LEON','TAMAULIPAS','SAN LUIS POTOSI','AGUASCALIENTES'),'ZACATECAS'] = 1
A['GUERRERO',c('MICHOACAN DE OCAMPO','PUEBLA','ESTADO DE MEXICO','MORELOS')] = 1
A[c('MICHOACAN DE OCAMPO','PUEBLA','ESTADO DE MEXICO','MORELOS'),'GUERRERO'] = 1
A['DURANGO',c('CHIHUAHUA','COAHUILA DE ZARAGOZA','ZACATECAS','NAYARIT','SINALOA')] = 1
A[c('CHIHUAHUA','COAHUILA DE ZARAGOZA','ZACATECAS','NAYARIT','SINALOA'),'DURANGO'] = 1
A['CHIHUAHUA',c('DURANGO','SINALOA','COAHUILA DE ZARAGOZA','SONORA')] = 1
A[c('DURANGO','SINALOA','COAHUILA DE ZARAGOZA','SONORA'),'CHIHUAHUA'] = 1
A['CHIAPAS',c('OAXACA','VERACRUZ LLAVE','TABASCO','CAMPECHE')] = 1
A[c('OAXACA','VERACRUZ LLAVE','TABASCO','CAMPECHE'),'CHIAPAS'] = 1
A['COLIMA',c('JALISCO','MICHOACAN DE OCAMPO')] = 1
A[c('JALISCO','MICHOACAN DE OCAMPO'),'COLIMA'] = 1　
A['COAHUILA DE ZARAGOZA',c('NUEVO LEON','ZACATECAS','DURANGO','CHIHUAHUA','SAN LUIS POTOSI')] = 1
A[c('NUEVO LEON','ZACATECAS','DURANGO','CHIHUAHUA','SAN LUIS POTOSI'),'COAHUILA DE ZARAGOZA'] = 1
A['SAN LUIS POTOSI',c('TABASCO','NUEVO LEON','COAHUILA DE ZARAGOZA','ZACATECAS','JALISCO','GUANAJUATO','QUERETARO DE ARTEAGA','HIDALGO','VERACRUZ LLAVE')] = 1
A[c('TABASCO','NUEVO LEON','COAHUILA DE ZARAGOZA','ZACATECAS','JALISCO','GUANAJUATO','QUERETARO DE ARTEAGA','HIDALGO','VERACRUZ LLAVE'),'SAN LUIS POTOSI'] = 1
A['CAMPECHE',c('TABASCO','QUINTANA ROO','YUCATAN')] = 1
A[c('TABASCO','QUINTANA ROO','YUCATAN'),'CAMPECHE'] = 1
A['BAJA CALIFORNIA SUR',c('BAJA CALIFORNIA','SONORA','SINALOA')] = 1
A[c('BAJA CALIFORNIA','SONORA','SINALOA'),'BAJA CALIFORNIA SUR'] = 1
A['BAJA CALIFORNIA',c('BAJA CALIFORNIA SUR','SONORA')] = 1
A[c('BAJA CALIFORNIA SUR','SONORA'),'BAJA CALIFORNIA'] = 1
A['AGUASCALIENTES',c('ZACATECAS','JALISCO')] = 1
A[c('ZACATECAS','JALISCO'),'AGUASCALIENTES'] = 1
A['YUCATAN',c('CAMPECHE','QUINTANA ROO')] = 1
A[c('CAMPECHE','QUINTANA ROO'),'YUCATAN'] = 1
A['TAMAULIPAS',c('NUEVO LEON','SAN LUIS POTOSI','VERACRUZ LLAVE')] = 1
A[c('NUEVO LEON','SAN LUIS POTOSI','VERACRUZ LLAVE'),'TAMAULIPAS'] = 1
A['TABASCO',c('CAMPECHE','CHIAPAS','VERACRUZ LLAVE')] = 1
A[c('CAMPECHE','CHIAPAS','VERACRUZ LLAVE'),'TABASCO'] = 1
A['SONORA',c('BAJA CALIFORNIA','BAJA CALIFORNIA SUR','SINALOA','CHIHUAHUA')] = 1
A[c('BAJA CALIFORNIA','BAJA CALIFORNIA SUR','SINALOA','CHIHUAHUA'),'SONORA'] = 1
A['SINALOA',c('SONORA','CHIHUAHUA','DURANGO','NAYARIT')] = 1
A[c('SONORA','CHIHUAHUA','DURANGO','NAYARIT'),'SINALOA'] = 1
A['QUINTANA ROO',c('YUCATAN','CAMPECHE')] = 1
A[c('YUCATAN','CAMPECHE'),'QUINTANA ROO'] =1
A['QUERETARO DE ARTEAGA',c('SAN LUIS POTOSI','HIDALGO','ESTADO DE MEXICO','GUANAJUATO','MICHOACAN DE OCAMPO')] = 1
A[c('SAN LUIS POTOSI','HIDALGO','ESTADO DE MEXICO','GUANAJUATO','MICHOACAN DE OCAMPO'),'QUERETARO DE ARTEAGA'] = 1
A['PUEBLA',c('ESTADO DE MEXICO','MORELOS','TLAXCALA','GUERRERO','OAXACA','VERACRUZ LLAVE','HIDALGO')] = 1
A[c('ESTADO DE MEXICO','MORELOS','TLAXCALA','GUERRERO','OAXACA','VERACRUZ LLAVE','HIDALGO'),'PUEBLA'] = 1
A['TLAXCALA',c('ESTADO DE MEXICO','HIDALGO','PUEBLA')] = 1
A[c('ESTADO DE MEXICO','HIDALGO','PUEBLA'),'TLAXCALA'] = 1
A['OAXACA',c('GUERRERO','PUEBLA','VERACRUZ LLAVE','CHIAPAS')] = 1
A[c('GUERRERO','PUEBLA','VERACRUZ LLAVE','CHIAPAS'),'OAXACA'] =1
colSums(A)
library(rstan)
options(mc.cores = parallel::detectCores())
rstan_options(auto_write = TRUE)
model <- stan_model('yi.stan')
X <- cbind(data$sex,data$age,data$asset_market_value,data$months_employed,data$ratio)
colnames(X) <- c('sex', 'age','asset market value','month employed','ratio')
scaled_x <- scale(X)
y = as.numeric(data$y)
y[y==1] = 0
y[y==2] = 1
state = as.vector(data$state)
unique_s = unique(state)
for (i in 1:32){
s = as.character(unique_s[i])
state[state==s] = as.numeric(i)
}
state = as.numeric(state)
X <- model.matrix(~scaled_x)
data_list <- list(k = nrow(X),         # number of observations
n = nrow(A),
p = ncol(X),         # number of coefficients
X = X,               # design matrix
y = y,               # observed number of cases
W = A,
k = 32,
W_n = sum(A) / 2,    # number of neighbor pairs
state = state)               # adjacency matrix
fit <- sampling(model, data = data_list)
fit
print(fit)
